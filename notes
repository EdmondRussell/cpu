./cpuminer -a sha256d -o stratum+tcp://solo.ckpool.org:3333 -u bc1q36dv4fqxa2z5m5h4hctxmdyp5xl6dxa480hvuu -p x -t $(nproc)
./cpuminer -a sha256d -o stratum+tcp://solo.ckpool.org:3333 -u bc1q36dv4fqxa2z5m5h4hctxmdyp5xl6dxa480hvuu -p x --thread=4

./cpuminer -a sha256d -o stratum+tcp://public-pool.io:3333 -u bitcoincash:qz8yud9mqjdvmgquvha7k6kmpr0ecsrx0sx68807t4 -p x -t $(nproc)
./cpuminer -a sha256d -o stratum+tcp://public-pool.io:3333 -u bitcoincash:qz8yud9mqjdvmgquvha7k6kmpr0ecsrx0sx68807t4 -p x --thread=4





#!/bin/bash

# Configuration
MIN_HASHRATE=5000
ADDRESS="bitcoincash:qz8yud9mqjdvmgquvha7k6kmpr0ecsrx0sx68807t4"
URL="stratum+tcp://eu2.solopool.org:8002"
THREADS=$(nproc)

run_miner() {
    echo "Starting miner..."
    # We use 'stdbuf' to ensure the output isn't buffered so we can read it instantly
    stdbuf -oL ./cpuminer -a sha256d -o "$URL" -u "$ADDRESS" -p x -t "$THREADS" 2>&1 | while read -r line; do
        echo "$line" # Print to terminal so you can still see it
        
        # Check if line contains hashrate info
        if [[ "$line" == *"Total:"* ]]; then
            # Extract the number before "kH/s"
            current_rate=$(echo "$line" | sed -n 's/.*Total: \([0-9.]*\) kH\/s.*/\1/p' | cut -d. -f1)
            
            if [ -n "$current_rate" ] && [ "$current_rate" -lt "$MIN_HASHRATE" ]; then
                echo "ALARM: Hashrate $current_rate kH/s is below $MIN_HASHRATE! Restarting..."
                pkill -P $$ cpuminer # Kill the miner process
                break # Break the while loop to restart
            fi
        fi
    done
}

# Keep the miner running forever
while true; do
    run_miner
    echo "Miner exited or was killed. Restarting in 5 seconds..."
    sleep 5
done



sudo apt update
sudo apt install build-essential dkms linux-headers-$(uname -r) automake autoconf libtool
sudo apt install zlib1g-dev libbz2-dev libncurses5-dev libncursesw5-dev libssl-dev
sudo apt install build-essential autoconf automake libtool libcurl4-openssl-dev libjansson-dev libssl-dev libgmp-dev

git clone https://github.com/tpruvot/cpuminer-multi.git
cd cpuminer-multi
./autogen.sh
./nomacro.pl
./configure CFLAGS="-march=native" --with-crypto=/usr/local/opt/openssl --with-curl
perl -p -i -e "s/#if \(WINDOWS\)/#define ASM 0\n#if (WINDOWS)/g" algo/neoscrypt.c
make

export CPPFLAGS="-I/usr/include/openssl"
export LDFLAGS="-L/usr/lib/x86_64-linux-gnu"
export OPENSSL_LIBS="-lssl -lcrypto"
./autogen.sh
./configure CFLAGS="-O3 -Wall -march=native -DNO_ASM" --with-curl
make clean
make -j$(nproc)
sudo make install  # optional

make distclean  # full clean
./autogen.sh
./configure CFLAGS="-O3 -Wall -march=native -DNO_ASM" --with-curl
make -j$(nproc)


cd ~  # or new dir
git clone https://github.com/JayDDee/cpuminer-opt.git
cd cpuminer-opt
./autogen.pl  # or ./autogen.sh
./configure CFLAGS="-O3 -march=native -funroll-loops" --with-curl
make -j$(nproc)

sudo lsof -i :4048
sudo systemd-resolve --flush-caches
sudo systemctl restart NetworkManager

macOS:
make clean
./autogen.sh
./nomacro.pl
./configure --with-curl --with-crypto --with-jansson
make

