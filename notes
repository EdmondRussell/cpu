./cpuminer -a sha256d -o stratum+tcp://solo.ckpool.org:3333 -u bc1q36dv4fqxa2z5m5h4hctxmdyp5xl6dxa480hvuu -p x -t $(nproc)
./cpuminer -a sha256d -o stratum+tcp://solo.ckpool.org:3333 -u bc1q36dv4fqxa2z5m5h4hctxmdyp5xl6dxa480hvuu -p x --thread=4

./cpuminer -a sha256d -o stratum+tcp://public-pool.io:3333 -u bitcoincash:qz8yud9mqjdvmgquvha7k6kmpr0ecsrx0sx68807t4 -p x -t $(nproc)
./cpuminer -a sha256d -o stratum+tcp://public-pool.io:3333 -u bitcoincash:qz8yud9mqjdvmgquvha7k6kmpr0ecsrx0sx68807t4 -p x --thread=4





#!/bin/bash

# Configuration
MIN_HASHRATE=5000
ADDRESS="bitcoincash:qz8yud9mqjdvmgquvha7k6kmpr0ecsrx0sx68807t4"
URL="stratum+tcp://eu2.solopool.org:8002"
THREADS=$(nproc)

run_miner() {
    echo "Starting miner with $THREADS threads..."
    # We use 'stdbuf' to prevent output buffering
    stdbuf -oL ./cpuminer -a sha256d -o "$URL" -u "$ADDRESS" -p x -t "$THREADS" 2>&1 | while read -r line; do
        echo "$line"
        
        # Check if line contains "CPU #" and "kH/s"
        if [[ "$line" == *"CPU #"* ]] && [[ "$line" == *"kH/s"* ]]; then
            # Extract the number specifically between the colon and 'kH/s'
            # This handles strings like "[timestamp] CPU #1: 6941 kH/s"
            current_rate=$(echo "$line" | sed -n 's/.*: \([0-9.]*\) kH\/s.*/\1/p' | cut -d. -f1)
            
            # Ensure current_rate is a valid number before comparing
            if [[ "$current_rate" =~ ^[0-9]+$ ]]; then
                if [ "$current_rate" -lt "$MIN_HASHRATE" ]; then
                    echo "--- WATCHDOG: Hashrate $current_rate kH/s dropped below $MIN_HASHRATE! ---"
                    # Kill the miner process group
                    pkill -P $$ cpuminer
                    break
                fi
            fi
        fi
    done
}

while true; do
    run_miner
    echo "Restarting miner in 5 seconds..."
    sleep 5
done







# Keep the miner running forever
while true; do
    run_miner
    echo "Miner exited or was killed. Restarting in 5 seconds..."
    sleep 5
done



sudo apt update
sudo apt install build-essential dkms linux-headers-$(uname -r) automake autoconf libtool
sudo apt install zlib1g-dev libbz2-dev libncurses5-dev libncursesw5-dev libssl-dev
sudo apt install build-essential autoconf automake libtool libcurl4-openssl-dev libjansson-dev libssl-dev libgmp-dev

git clone https://github.com/tpruvot/cpuminer-multi.git
cd cpuminer-multi
./autogen.sh
./nomacro.pl
./configure CFLAGS="-march=native" --with-crypto=/usr/local/opt/openssl --with-curl
perl -p -i -e "s/#if \(WINDOWS\)/#define ASM 0\n#if (WINDOWS)/g" algo/neoscrypt.c
make

export CPPFLAGS="-I/usr/include/openssl"
export LDFLAGS="-L/usr/lib/x86_64-linux-gnu"
export OPENSSL_LIBS="-lssl -lcrypto"
./autogen.sh
./configure CFLAGS="-O3 -Wall -march=native -DNO_ASM" --with-curl
make clean
make -j$(nproc)
sudo make install  # optional

make distclean  # full clean
./autogen.sh
./configure CFLAGS="-O3 -Wall -march=native -DNO_ASM" --with-curl
make -j$(nproc)


cd ~  # or new dir
git clone https://github.com/JayDDee/cpuminer-opt.git
cd cpuminer-opt
./autogen.pl  # or ./autogen.sh
./configure CFLAGS="-O3 -march=native -funroll-loops" --with-curl
make -j$(nproc)

sudo lsof -i :4048
sudo systemd-resolve --flush-caches
sudo systemctl restart NetworkManager

macOS:
make clean
./autogen.sh
./nomacro.pl
./configure --with-curl --with-crypto --with-jansson
make

